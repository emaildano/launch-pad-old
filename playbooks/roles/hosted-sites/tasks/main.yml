---
- include: nginx.yml
- include_vars: ~/sites.yml

- name: Create web root
  file:
    path: "{{ www_root }}"
    owner: "{{ web_user }}"
    group: "{{ web_group }}"
    mode: 0755
    state: directory
  with_dict: hosted_sites

- name: Create logs folder
  file:
    path: "{{ www_root }}/{{ item.key }}/logs"
    owner: "{{ web_user }}"
    group: "{{ web_group }}"
    mode: 0755
    state: directory
  with_dict: hosted_sites

- name: Create web folder
  file:
    path: "{{ www_root }}/{{ item.key }}/web"
    owner: "{{ web_user }}"
    group: "{{ web_group }}"
    mode: 0755
    state: directory
  with_dict: hosted_sites

- name: Set ACLs
  acl: name=/srv/www recursive=yes entity=www-data etype=group permissions=rwx state=present

- name: Set ACL Default
  acl: name=/srv/www recursive=yes default=yes entity=www-data etype=group permissions=rwx state=present
